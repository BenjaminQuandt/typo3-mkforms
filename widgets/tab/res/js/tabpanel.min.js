/**
* @author Ryan Johnson <ryan@livepipe.net>
* @copyright 2007 LivePipe LLC
* @package Control.Tabs
* @license MIT
* @url http://livepipe.net/projects/control_tabs/
* @version 1.4
*/
Formidable.Classes.TabPanel=Formidable.Classes.RdtBaseClass.extend({activeContainer:!1,contructor:function(a){this.base(a);this.init(this.config.id,this.config.options)},init:function(a,b){a=$(a);this.options=$H({beforeChange:Prototype.emptyFunction,afterChange:Prototype.emptyFunction,linkSelector:"li a",activeClassName:"active",defaultTab:"first",autoLinkExternal:!0}).merge(b||{});this.containers=$H({});this.links=(typeof("string"==this.options.linkSelector)?a.getElementsBySelector(this.options.linkSelector):
this.options.linkSelector(a)).findAll(function(a){return/^#/.exec(a.href.replace(window.location.href.split("#")[0],""))});this.links.each(function(a){a.key=$A(a.getAttribute("href").replace(window.location.href.split("#")[0],"").split("/")).last().replace(/#/,"");this.containers[a.key]=$(a.key);a.onclick=function(a){this.setActiveTab(a);return!1}.bind(this,a)}.bind(this));"first"==this.options.defaultTab?this.setActiveTab(this.links.first()):"last"==this.options.defaultTab?this.setActiveTab(this.links.last()):
this.setActiveTab(this.options.defaultTab);target_regexp=/#(.+)$/;(targets=target_regexp.exec(window.location))&&targets[1]&&$A(targets[1].split(",")).each(function(a){this.links.each(function(a,b){if(b.key==a)throw this.setActiveTab(b),$break;}.bind(this,a))}.bind(this));this.options.autoLinkExternal&&$A(document.getElementsByTagName("a")).each(function(a){clean_href=a.href.replace(window.location.href.split("#")[0],"");"#"==clean_href.substring(0,1)&&this.containers.keys().include(clean_href.substring(1))&&
$(a).observe("click",function(a,b){this.setActiveTab(b.substring(1))}.bindAsEventListener(this,clean_href))}.bind(this))},setActiveTab:function(a){"undefined"!=typeof a&&!1!=a&&("string"==typeof a?this.links.each(function(b){if(b.key==a)throw this.setActiveTab(b),$break;}.bind(this)):(this.containers.each(function(a){a[1].hide()}),this.links.each(function(a){a.removeClassName(this.options.activeClassName)}.bind(this)),a.addClassName(this.options.activeClassName),this.options.beforeChange(this,this.activeContainer),
this.activeContainer=this.containers[a.key],this.containers[a.key].show(),this.options.afterChange(this.containers[a.key])))}});