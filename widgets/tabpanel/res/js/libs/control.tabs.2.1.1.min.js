/*
 2007 LivePipe LLC
 @package Control.Tabs
 @license MIT
 @url http://livepipe.net/projects/control_tabs/
 @version 2.1.1
*/
if("undefined"==typeof Control)var Control={};
Control.Tabs=Base.extend({constructor:function(a,b){if(MKWrapper.$(a)){this.activeLink=this.activeContainer=!1;this.containers={};this.links=[];Control.Tabs.instances.push(this);this.options={beforeChange:function(){},afterChange:function(){},hover:!1,linkSelector:"li a",setClassOnContainer:!1,activeClassName:"active",defaultTab:"first",autoLinkExternal:!0,targetRegExp:/#(.+)$/,showFunction:MKWrapper.fxAppear,hideFunction:MKWrapper.fxHide};MKWrapper.extend(this.options,b||{});var c="string"==typeof this.options.linkSelector?
MKWrapper.findChilds(MKWrapper.$(a),this.options.linkSelector):this.options.linkSelector(MKWrapper.$(a));MKWrapper.each(MKWrapper.filter(c,function(a){return/^#/.exec(a.href.replace(window.location.href.split("#")[0],""))}),function(a){this.addTab(a)}.bind(this));MKWrapper.each(Formidable.objValues(this.containers),this.options.hideFunction);"first"==this.options.defaultTab?this.setActiveTab(this.links[0]):"last"==this.options.defaultTab?this.setActiveTab(this.links[this.links.length-1]):"none"!=
this.options.defaultTab&&this.setActiveTab(this.options.defaultTab);(c=this.options.targetRegExp.exec(window.location))&&c[1]&&MKWrapper.each(c[1].split(","),function(a){MKWrapper.each(this.links,function(a,b){if(b.key==a)return this.setActiveTab(b),!1}.bind(this,a))}.bind(this));this.options.autoLinkExternal&&MKWrapper.each(document.getElementsByTagName("a"),function(a){if(!MKWrapper.inArray(a,this.links)){var b=a.href.replace(window.location.href.split("#")[0],"");"#"==b.substring(0,1)&&this.containers[b.substring(1)]&&
MKWrapper.attachEvent(MKWrapper.$(a),"click",function(a){this.setActiveTab(b.substring(1))},this)}}.bind(this))}},addTab:function(a){var b=this;this.links.push(a);var c=a.getAttribute("href").split("#");a.key=c[c.length-1];this.containers[a.key]=MKWrapper.$(a.key);MKWrapper.attachEvent(MKWrapper.$(a),this.options.hover?"mouseover":"click",function(c){MKWrapper.stopEvent(c);b.setActiveTab(a);return!1},this)},setActiveTab:function(a){a&&("string"==typeof a?MKWrapper.each(this.links,function(b){if(b.key==
a)return this.setActiveTab(b),!1}.bind(this)):(this.notify("beforeChange",this.activeContainer),this.activeContainer&&this.options.hideFunction(this.activeContainer),MKWrapper.each(this.links,function(a){MKWrapper.removeClass(this.options.setClassOnContainer?MKWrapper.$(a.parentNode):a,this.options.activeClassName)}.bind(this)),MKWrapper.addClass(this.options.setClassOnContainer?MKWrapper.$(a.parentNode):a,this.options.activeClassName),this.activeContainer=this.containers[a.key],this.activeLink=a,
this.options.showFunction(this.containers[a.key]),this.notify("afterChange",this.containers[a.key])))},next:function(){var a=!1;MKWrapper.each(this.links,function(b,c){this.activeLink==b&&this.links[c+1]&&(a=this.links[c+1])}.bind(this));this.setActiveTab(a);return!1},previous:function(){MKWrapper.each(this.links,function(a,b){this.activeLink==a&&this.links[b-1]&&this.setActiveTab(this.links[b-1])}.bind(this));return!1},first:function(){this.setActiveTab(this.links.first());return!1},last:function(){this.setActiveTab(this.links.last());
return!1},notify:function(a){try{if(this.options[a])return[this.options[a].apply(this.options[a],arguments.slice(1))]}catch(b){return!1}}});MKWrapper.extend(Control.Tabs,{instances:[],findByTabId:function(a){return Control.Tabs.instances.find(function(b){return b.links.find(function(b){return b.key==a})})}});